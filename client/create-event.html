<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Event</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Actor&family=Forum&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2D3047',    // dark blue
                        secondary: '#419D78',  // green
                        accent: '#E0A458',     // gold
                        light: '#F7F7F7',      // light gray
                        dark: '#1A1B1E'        // dark gray
                    },
                    fontFamily: {
                        'actor': ['Actor', 'sans-serif'],
                        'forum': ['Forum', 'serif']
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-light min-h-screen font-actor">
    <div class="max-w-5xl mx-auto px-4 py-12">
        <div class="flex justify-between items-center mb-12">
            <h1 class="text-4xl font-forum font-bold text-primary">Create New Event</h1>
            <a href="/" class="px-6 py-3 bg-white text-primary border border-gray-200 rounded-lg hover:bg-gray-50 transition-all duration-200 font-actor shadow-sm">
                Back to Events
            </a>
        </div>

        <form id="eventForm" class="bg-white rounded-xl shadow-lg p-8 space-y-8">
            <div>
                <label for="eventName" class="block text-sm font-forum text-primary mb-2">Event Name:</label>
                <input type="text" id="eventName" name="eventName" required
                    class="w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
            </div>

            <div>
                <label for="eventDescription" class="block text-sm font-forum text-primary mb-2">Description:</label>
                <textarea id="eventDescription" name="eventDescription" rows="4" required
                    class="w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor"></textarea>
            </div>

            <div>
                <label class="block text-sm font-forum text-primary mb-2">Location:</label>
                <div class="space-y-4">
                    <div>
                        <label for="eventStreet" class="block text-sm font-forum text-primary mb-2">Street Address:</label>
                        <input type="text" id="eventStreet" name="eventStreet" required
                            class="w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="md:col-span-1">
                            <label for="eventCity" class="block text-sm font-forum text-primary mb-2">City:</label>
                            <input type="text" id="eventCity" name="eventCity" required
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
                        </div>
                        <div>
                            <label for="eventState" class="block text-sm font-forum text-primary mb-2">State:</label>
                            <select id="eventState" name="eventState" required
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
                                <option value="">Select State</option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                                <option value="DC">District of Columbia</option>
                            </select>
                        </div>
                        <div>
                            <label for="eventZipCode" class="block text-sm font-forum text-primary mb-2">Zip Code:</label>
                            <input type="text" id="eventZipCode" name="eventZipCode" required pattern="[0-9]{5}"
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="eventDate" class="block text-sm font-forum text-primary mb-2">Date:</label>
                    <input type="date" id="eventDate" name="eventDate" required
                        class="w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
                </div>
                <div>
                    <label for="eventTime" class="block text-sm font-forum text-primary mb-2">Time:</label>
                    <div class="flex space-x-2">
                        <select id="eventHour" name="eventHour" required
                            class="w-1/3 px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
                            <!-- Hours will be populated by JavaScript -->
                        </select>
                        <select id="eventMinute" name="eventMinute" required
                            class="w-1/3 px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
                            <option value="00">00</option>
                            <option value="30">30</option>
                        </select>
                        <select id="eventPeriod" name="eventPeriod" required
                            class="w-1/3 px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
                            <option value="AM">AM</option>
                            <option value="PM">PM</option>
                        </select>
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-sm font-forum text-primary mb-2">Tags:</label>
                <div class="tags-input-container space-y-4">
                    <!-- New tag input -->
                    <div class="relative">
                        <input type="text" id="newTagInput" 
                            placeholder="Add tags separated by comma"
                            class="w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent font-actor">
                    </div>
                    
                    <!-- Selected tags display -->
                    <div id="selected-tags" class="flex flex-wrap gap-2">
                        <!-- Selected tags will be displayed here -->
                    </div>

                    <!-- Available tags section -->
                    <div>
                        <p class="text-sm font-forum text-primary mb-2">Or choose from existing tags:</p>
                        <div id="tags-list" class="flex flex-wrap gap-2 mb-3">
                            <!-- Existing tags will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-4">
                <button type="button" onclick="window.location.href='/'" 
                    class="px-5 py-2.5 bg-white text-primary border border-gray-200 rounded-lg hover:bg-gray-50 transition-all duration-200 font-actor shadow-sm">
                    Cancel
                </button>
                <button type="submit" 
                    class="px-5 py-2.5 bg-secondary text-white rounded-lg hover:bg-opacity-90 transition-all duration-200 font-actor shadow-sm">
                    Create Event
                </button>
            </div>
        </form>
    </div>

    <script>
        // Initialize variables
        const selectedTagsSet = new Set();
        const tagsList = document.getElementById('tags-list');
        const selectedTags = document.getElementById('selected-tags');
        const eventForm = document.getElementById('eventForm');
        const newTagInput = document.getElementById('newTagInput');

        // Populate hours in the time selector
        const hourSelect = document.getElementById('eventHour');
        for (let i = 1; i <= 12; i++) {
            const option = document.createElement('option');
            option.value = i.toString().padStart(2, '0');
            option.textContent = i.toString().padStart(2, '0');
            hourSelect.appendChild(option);
        }

        // Handle new tag input
        newTagInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ',') {
                e.preventDefault();
                const tags = newTagInput.value.split(',').map(tag => tag.trim()).filter(tag => tag);
                tags.forEach(async (tag) => {
                    if (tag && !selectedTagsSet.has(tag)) {
                        // Try to create the new tag on the server
                        try {
                            const response = await fetch('/api/tags', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ name: tag })
                            });
                            
                            if (response.ok) {
                                selectedTagsSet.add(tag);
                                updateSelectedTagsDisplay();
                                loadTags(); // Refresh the available tags list
                            }
                        } catch (error) {
                            console.error('Error creating new tag:', error);
                        }
                    }
                });
                newTagInput.value = '';
            }
        });

        function toggleTag(tagName) {
            if (selectedTagsSet.has(tagName)) {
                selectedTagsSet.delete(tagName);
            } else {
                selectedTagsSet.add(tagName);
            }
            updateSelectedTagsDisplay();
        }

        function updateSelectedTagsDisplay() {
            selectedTags.innerHTML = Array.from(selectedTagsSet).map(tag => `
                <span class="inline-flex items-center px-4 py-2 bg-secondary bg-opacity-10 text-secondary rounded-lg font-actor">
                    ${tag}
                    <button type="button" 
                        class="ml-2 text-secondary hover:text-opacity-80 transition-all duration-200"
                        onclick="toggleTag('${tag}')">
                        ×
                    </button>
                </span>
            `).join('');
        }

        async function loadTags() {
            try {
                const response = await fetch('/api/tags');
                const tags = await response.json();
                tagsList.innerHTML = tags.map(tag => `
                    <button type="button" 
                        onclick="toggleTag('${tag.name}')"
                        class="px-4 py-2 bg-light text-primary rounded-lg hover:bg-gray-100 transition-all duration-200 font-actor ${
                            selectedTagsSet.has(tag.name) ? 'bg-secondary bg-opacity-10' : ''
                        }">
                        ${tag.name}
                    </button>
                `).join('');
            } catch (error) {
                console.error('Error loading tags:', error);
            }
        }

        // Load tags when page loads
        loadTags();

        // Handle form submission
        eventForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(eventForm);
            const hour = formData.get('eventHour');
            const minute = formData.get('eventMinute');
            const period = formData.get('eventPeriod');
            
            const eventData = {
                name: formData.get('eventName'),
                description: formData.get('eventDescription'),
                location: {
                    street: formData.get('eventStreet'),
                    city: formData.get('eventCity'),
                    state: formData.get('eventState'),
                    zipCode: formData.get('eventZipCode')
                },
                date: formData.get('eventDate'),
                time: `${hour}:${minute} ${period}`,
                tags: Array.from(selectedTagsSet)
            };

            try {
                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(eventData)
                });

                if (!response.ok) {
                    throw new Error('Failed to create event');
                }

                // Redirect to home page after successful creation
                window.location.href = '/';
            } catch (error) {
                console.error('Error creating event:', error);
                alert('Failed to create event. Please try again.');
            }
        });
    </script>
</body>
</html> 